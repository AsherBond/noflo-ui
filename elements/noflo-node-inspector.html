<polymer-element name="noflo-node-inspector" attributes="node graph">
  <style>
    label {
      display: block;
    }
  </style>
  <template>
    <h1>{{ node.label }}</h1>
    <ul>
      <template repeat="{{ port in inports }}">
        <li>
        <label>{{ port.name }}
          <template if="{{ port.type == 'bang' }}">
            <button name="{{ port.name }}" on-click="{{ sendBang }}"><i class="icon-exclamation"></i></button>
          </template>
          <template if="{{ port.type == 'boolean' }}">
            <input type="checkbox" name="{{ port.name }}" checked="{{ port.value }}" on-blur="{{ updateValue }}">
          </template>
          <template if="{{ port.type != 'bang' && port.type != 'boolean' }}">
            <input type="{{ port.type }}" name="{{ port.name }}" value="{{ port.value }}" on-blur="{{ updateValue }}">
          </template>
          </label>
          <template if="{{ port.type != 'bang' }}">
            <button data-port="{{ port.name }}" on-click="{{ removeValue }}"><i class="icon-trash"></i></button>
          </template>
        </li>
      </template>
    </ul>
  </template>
  <script>
    Polymer('noflo-node-inspector', {
      inports: [],
      enteredView: function () {
        this.updatePorts();
      },
      updatePorts: function () {
        this.inports = [];
        this.node.getInports().forEach(function (port) {
          if (port.isConnected()) {
            return;
          }
          this.inports.push({
            name: port.name,
            type: port.type,
            value: port.getValue()
          });
        }.bind(this));
      },
      updateValue: function (event, detail, sender) {
        event.preventDefault();
        if (!sender.value) {
          return;
        }
        var port = this.node.getInportByName(sender.getAttribute('name'));
        port.setValue(sender.value);
      },
      removeValue: function (event, detail, sender) {
        event.preventDefault();
        var name = sender.getAttribute('data-port');
        var port = this.node.getInportByName(name);
        port.removeValue();
        this.inports.forEach(function (port) {
          if (port.name === name) {
            port.value = null;
          }
        });
      },
      sendBang: function (event, detail, sender) {
        event.preventDefault();
        var name = sender.getAttribute('name');

        console.log('BANG', this.node.getAttribute('name'), name);
      }
    });
  </script>
</polymer-element>
